%% Disclaimer : This script does not reflect any real application of the dfs script-language,
%% it just makes sense syntactically ;)

   %% Definitions
   def inStreamId = '1.004.987349f9e87fwef'
   def outStreamId = '2.404.5dfgs555sa5df5a'
   % false lambda: must be speicifed before primary-expr
   def host = 'de.example.com'
   def dead_message = 'LOW on CARBONIDE !!!'
   def deadman_period = 15m
   def bool = TRUE
   def number = 33.4434

   def in1 =
      |stream_in(bool)
      .from(inStreamId)

   def in2 =
      |stream_in()
        .from('1.004.987349f9e87fwef')

   def alle = 'viele'

   in1
   |deadman(deadman_period, 30)
        .msg(dead_message)

   in2
      |deadman(15, 30s)

   def m = 'pm'

   in2
      |join(in1)
      .on('val')
      .translate(
        ?_chair?, %% 'red_chair', red_desk
        lambda: "opmean.val" + 2 * max("val1", "val2")/3,
        myNextParam,
        lambda: ("max" - "min") /2,
        lambda: string("max") == '5',
        lambda: str_ends_with(inStreamId, 'fwef'),
        lambda: str_ends_with("muxolo", 'olo'),
        lambda: lookup(deadman_period) + number,
        lambda: string(bool)
        )

      |lambda(
        lambda: str_trim("host") == 'server001.example.com',
        mode,
        '12354688978' %% numberstring here
      )
      |window()
      .every(15s)
      .period(30m)
      .stats(esp_mean, esp_difference)
      .field('val')
      .as('mean', 'diff')
      .align(lambda: (hour("ts")) > 3 AND (hour("ts") < 9))
      @outlier()
       .tolerance(sigma())

      %% write to outstream
      |stream_out(outStreamId)
      .translate(lambda: 5 > "mean")
      |alert()
      .critical(
      %% alert when point value is more than 3 stdvs away
      %% from running mean
        lambda: sigma("value") > 3,
        _global, 22.589
        )
        .when(lambda: hour("ts") >= 8 AND hour("ts") <= 18 AND day_of_week("ts") != 7)

   in1
           |eval(lambda: "value" * "value", lambda: 1/"value2")
               .as('value2', 'inv_value2')

      |shift(-6h)

  def threshold = 333
  def boolTrue = true
  def boolFalse = false
  def in12 =
    in1
    |eval(lambda: if(( "ts" > (max(threshold,23.55) + 2)), boolTrue, boolFalse) )
    .as('ts_greater')

    in12
    |push(13)

    @moving_avg("gold")
    .step_size(14)

